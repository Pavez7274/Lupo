"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.run=exports.type=exports.name=void 0;const discord_js_1=require("discord.js"),Arguments_1=require("../structures/Arguments");async function run(o,a){if(!a.author.bot&&a.channel.permissionsFor(await a.guild.members.fetchMe()).has(discord_js_1.PermissionFlagsBits.SendMessages)&&!(await a.guild.members.fetchMe()).isCommunicationDisabled()){await a.guild.members.fetch()?.catch(()=>{});const u=[await o.db.get("guild_prefix",a.guild.id,"?"),`<@${o?.user?.id}>`,`<@!${o?.user?.id}>`,"lappy"],r=await u.find(e=>a.content.toLowerCase().startsWith(e))||"";let{channel:s,guild:t,author:i,member:n}=a,e=new Arguments_1.Arguments(a,r);if(i=await i.fetch()??i,u.slice(1).includes(a.content.trim()))return a.reply("my prefix here is `".concat(u[0].concat("`")));if(r){let r=e.shift();const c=o.cmds.default.find(e=>e.names.includes(r?.toLowerCase()));if(c){if(c.dev&&!o.owners.includes(i.id)||o.owners.includes(i.id)&&e.ends.includes("--dev-error"))return o.permsError({author:i},a,["developer"]);if("perms"in c&&c.perms?.map(e=>n.permissionsIn(s).has(discord_js_1.PermissionFlagsBits[e]))?.some(e=>!e))return o.permsError({author:i},a,c.perms);if("bot_perms"in c&&c.bot_perms?.forEach(e=>t?.me?.permissionsIn(s)?.has(discord_js_1.PermissionFlagsBits[e]))?.some(e=>!e))return o.permsError({author:o.user},a,c.bot_perms);var m,d=c?.fields?.filter(e=>e.req)||[];if(d.length>e.len)return m=d.length-e.len,o.sendError({author:i},a,"Field",`Field ${m} ['${d[m-1]?.name||"unknow-name"}'] Cannot Be Empty`);try{return await c.run({command:c,prefixes:u,lappy:o,author:i,memb:n,args:e,cmd:r,msg:a,ch:s,gd:t})}catch(e){return console.log(e),o.sendError({author:i},a,e.name,e.stack)}}}}}exports.name="messageCreate",exports.type="dsc",exports.run=run;