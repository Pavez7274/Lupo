"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.run=exports.type=exports.name=void 0;const Arguments_1=require("../structures/Arguments");async function run(i,a){if(!a.author.bot&&a.guild.me.permissionsIn(a.channel).has("SEND_MESSAGES")){await a.guild.members.fetch()?.catch(()=>{});const d=[await i.db.get("guild_prefix",a.guild.id,"?"),`<@${i?.user?.id}>`,`<@!${i?.user?.id}>`,"lappy"],r=await d.find(e=>a.content.toLowerCase().startsWith(e))||"";let{channel:s,guild:t,author:n,member:o}=a,e=new Arguments_1.Arguments(a,r);if(d.slice(1).includes(a.content.trim()))return a.reply("my prefix here is `".concat(d[0].concat("`")));if(r){let r=e.shift();const c=i.cmds.default.find(e=>e.names.includes(r?.toLowerCase()));if(c){if(c.dev&&!i.owners.includes(n.id)||i.owners.includes(n.id)&&e.ends.includes("--dev-error"))return i.permsError({author:n},a,["developer"]);if("perms"in c&&c.perms?.map(e=>o.permissionsIn(s).has(e))?.some(e=>!e))return i.permsError({author:n},a,c.perms);if("bot_perms"in c&&c.bot_perms?.forEach(e=>t?.me?.permissionsIn(s)?.has(e))?.some(e=>!e))return i.permsError({author:i.user},a,c.bot_perms);var u,m=c?.fields?.filter(e=>e.req)||[];if(m.length>e.len)return u=m.length-e.len,i.sendError({author:n},a,"Field",`Field ${u} ['${m[u-1]?.name||"unknow-name"}'] Cannot Be Empty`);try{return await c.run({command:c,prefixes:d,lappy:i,author:n,memb:o,args:e,cmd:r,msg:a,ch:s,gd:t})}catch(e){return console.log(e),i.sendError({author:n},a,e.name,e.stack)}}}}}exports.name="messageCreate",exports.type="dsc",exports.run=run;