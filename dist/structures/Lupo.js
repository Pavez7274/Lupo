"use strict";var emotes,__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.Lupo=void 0;const discord_js_1=require("discord.js"),soundcloud_1=require("@distube/soundcloud"),spotify_1=require("@distube/spotify"),generateCommandDoc_1=require("../util/generateCommandDoc"),DataBase_1=require("./DataBase"),glob_1=require("glob"),distube_1=__importDefault(require("distube"));!function(e){e.error="<:lappyAaa:913295794151501864>",e.feli="<:lappyfeli:913295978205966338>",e.tofu="<:lappytofu:902410429601570866>"}(emotes=emotes||{});class Lupo extends discord_js_1.Client{constructor(){super({allowedMentions:{repliedUser:!1},presence:{status:"dnd",activities:[{name:"* Naoki Solutions :: New Source",type:0}]},intents:[1,2,128,512]}),Object.defineProperties(this,{db:{value:new DataBase_1.DB({tables:[{name:"main"},{name:"snipe"}],path:"./db/"},"main")},music:{value:new distube_1.default(this,{plugins:[new soundcloud_1.SoundCloudPlugin,new spotify_1.SpotifyPlugin],leaveOnFinish:!1,leaveOnEmpty:!1,leaveOnStop:!1,searchSongs:5,nsfw:!0,youtubeDL:!1})},cache:{value:new discord_js_1.Collection},cmds:{value:new Object},emotes:{value:emotes},owners:{value:["788869971073040454","878235498055864382"]}})}commands(){return console.log("* [handler] :: Running -> Commands"),(0,glob_1.sync)(process.cwd()+"/dist/cmds/**/*.js").forEach(async e=>{e&&require.cache[e]&&delete require.cache[e];let s=require(e);"type"in(s="default"in s?s.default:s)||(s.type="default"),"fields"in s&&(s.parsedFields=s.fields.map(e=>e.req?`<${e.name}>`:`[${e.name}]`)),this.cmds[s.type]||(this.cmds[s.type]=new discord_js_1.Collection);try{this.cmds[s.type].set(s.names[0]??"unknown",s),console.log(`* [handler] :: loaded command '${s.names[0]??"unknown"}'`),(0,generateCommandDoc_1.generateCommandDoc)(s)}catch(e){console.log(`* [handler] :: failed to load command '${s.names[0]??"unknown"}' because `+e)}}),this}events(){return console.log("* [handler] :: Running -> Events"),(0,glob_1.sync)(process.cwd()+"/dist/events/**/*.js").forEach(async e=>{try{e&&require.cache[e]&&delete require.cache[e];let s=require(e);"dsc"===s.type?this?.[s.once?"once":"on"](s.name,(...e)=>s.run(this,...e)):this?.[s.type]?.[s.once?"once":"on"](s.name,(...e)=>s.run(this,...e)),console.log(`* [handler] :: loaded event '${s.name??"unknown"}'`)}catch(e){console.log(e)}}),this}start(){return this.db.connect(),this.events().commands().on("debug",console.log).login(),this}permsError(e,s,o,t=e.author){!e.target&&t&&(e.target=t);t=this.makeEmbeds(e,{title:this.emotes.error+" | [Error] -> Missing Permissions",description:`Member/User: ${t?.toString()||"unknown"}
Permissions:
${o.join(", ").toCodeBlock()}
`});return s.reply?s.reply({embeds:t}):s.send({embeds:t})}sendError(e,s,o,t,n=e.author,r=[],i=" "){o=this.makeEmbeds(e,{title:this.emotes.error+" | [Error] "+(o?" -> "+o:""),description:t?.toCodeBlock()||"```js\nFailed To Display Error```"});return s.reply?s.reply({embeds:o,components:r,content:i}):s.send({embeds:o})}makeEmbeds(t,...e){const n=new Array;return e.forEach((e,s)=>{if(!(5<s)){const o=new discord_js_1.MessageEmbed(e);!o.thumbnail&&t.target&&o.setThumbnail(t.target?.displayAvatarURL()),o.color||o.setColor("BLURPLE"),n.push(o)}}),n}}exports.Lupo=Lupo;